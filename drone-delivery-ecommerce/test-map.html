<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test OpenStreetMap API</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .map-container {
            width: 100%;
            height: 500px;
            border: 2px solid #333;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        #testMap {
            width: 100%;
            height: 100%;
            border-radius: 6px;
        }
        
        .info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ Test OpenStreetMap API</h1>
    
    <div class="info">
        <h3>ğŸ“ ThÃ´ng tin test:</h3>
        <ul>
            <li><strong>API:</strong> OpenStreetMap tile server</li>
            <li><strong>ThÆ° viá»‡n:</strong> Leaflet.js v1.9.4</li>
            <li><strong>Vá»‹ trÃ­:</strong> ThÃ nh phá»‘ Há»“ ChÃ­ Minh</li>
            <li><strong>Zoom:</strong> Level 12</li>
        </ul>
    </div>
    
    <div id="status" class="status">Äang khá»Ÿi táº¡o báº£n Ä‘á»“...</div>
    
    <div class="map-container">
        <div id="testMap"></div>
    </div>
    
    <div class="controls">
        <button onclick="addMarker()">ğŸ“ ThÃªm marker</button>
        <button onclick="goToHanoi()">ğŸ¢ Äáº¿n HÃ  Ná»™i</button>
        <button onclick="goToHCM()">ğŸ™ï¸ Äáº¿n TP.HCM</button>
        <button onclick="goToDaNang()">ğŸ–ï¸ Äáº¿n ÄÃ  Náºµng</button>
        <button onclick="testRoute()">ğŸ›£ï¸ Test routing</button>
    </div>
    
    <div class="info">
        <h3>ğŸ” Kiá»ƒm tra:</h3>
        <ul id="checkList">
            <li id="leafletLoad">âœ… Leaflet.js Ä‘Ã£ load</li>
            <li id="mapInit">â³ Khá»Ÿi táº¡o báº£n Ä‘á»“...</li>
            <li id="tilesLoad">â³ Loading tiles...</li>
            <li id="interaction">â³ Test tÆ°Æ¡ng tÃ¡c...</li>
        </ul>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <script>
        let testMap;
        let markers = [];
        
        // Status functions
        function updateStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
        }
        
        function updateCheck(id, success, message) {
            const element = document.getElementById(id);
            element.innerHTML = (success ? 'âœ…' : 'âŒ') + ' ' + message;
        }
        
        // Initialize map
        function initMap() {
            try {
                updateStatus('Äang khá»Ÿi táº¡o báº£n Ä‘á»“...');
                
                // Check if Leaflet is loaded
                if (typeof L === 'undefined') {
                    updateCheck('leafletLoad', false, 'Leaflet.js khÃ´ng load Ä‘Æ°á»£c');
                    updateStatus('Lá»—i: Leaflet.js khÃ´ng load Ä‘Æ°á»£c', true);
                    return;
                }
                
                updateCheck('leafletLoad', true, 'Leaflet.js Ä‘Ã£ load');
                
                // Create map centered on Ho Chi Minh City
                testMap = L.map('testMap', {
                    center: [10.8231, 106.6297],
                    zoom: 12,
                    zoomControl: true
                });
                
                updateCheck('mapInit', true, 'Báº£n Ä‘á»“ Ä‘Ã£ khá»Ÿi táº¡o');
                
                // Add OpenStreetMap tiles
                const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 18
                });
                
                tileLayer.addTo(testMap);
                
                // Wait for tiles to load
                tileLayer.on('load', function() {
                    updateCheck('tilesLoad', true, 'Tiles Ä‘Ã£ load thÃ nh cÃ´ng');
                    updateStatus('âœ… Báº£n Ä‘á»“ hoáº¡t Ä‘á»™ng tá»‘t!');
                });
                
                tileLayer.on('tileerror', function() {
                    updateCheck('tilesLoad', false, 'Lá»—i loading tiles');
                    updateStatus('âŒ Lá»—i loading tiles tá»« OpenStreetMap', true);
                });
                
                // Add a marker at Ho Chi Minh City
                const hcmMarker = L.marker([10.8231, 106.6297])
                    .addTo(testMap)
                    .bindPopup('<b>ThÃ nh phá»‘ Há»“ ChÃ­ Minh</b><br>Trung tÃ¢m kinh táº¿ Viá»‡t Nam')
                    .openPopup();
                
                markers.push(hcmMarker);
                
                // Test interaction
                testMap.on('click', function(e) {
                    updateCheck('interaction', true, 'Click interaction hoáº¡t Ä‘á»™ng');
                    console.log('Map clicked at: ', e.latlng);
                });
                
                // Test zoom
                testMap.on('zoomend', function() {
                    console.log('Current zoom: ', testMap.getZoom());
                });
                
                console.log('Map initialized successfully');
                
            } catch (error) {
                console.error('Map initialization error:', error);
                updateCheck('mapInit', false, 'Lá»—i khá»Ÿi táº¡o: ' + error.message);
                updateStatus('âŒ Lá»—i khá»Ÿi táº¡o báº£n Ä‘á»“: ' + error.message, true);
            }
        }
        
        // Control functions
        function addMarker() {
            if (!testMap) return;
            
            const lat = 10.8231 + (Math.random() - 0.5) * 0.1;
            const lng = 106.6297 + (Math.random() - 0.5) * 0.1;
            
            const marker = L.marker([lat, lng])
                .addTo(testMap)
                .bindPopup(`<b>Marker ngáº«u nhiÃªn</b><br>Lat: ${lat.toFixed(4)}<br>Lng: ${lng.toFixed(4)}`);
            
            markers.push(marker);
            updateStatus(`âœ… ÄÃ£ thÃªm marker táº¡i ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
        }
        
        function goToHanoi() {
            if (!testMap) return;
            testMap.setView([21.0285, 105.8542], 13);
            updateStatus('ğŸ“ ÄÃ£ chuyá»ƒn Ä‘áº¿n HÃ  Ná»™i');
        }
        
        function goToHCM() {
            if (!testMap) return;
            testMap.setView([10.8231, 106.6297], 12);
            updateStatus('ğŸ“ ÄÃ£ chuyá»ƒn Ä‘áº¿n TP.HCM');
        }
        
        function goToDaNang() {
            if (!testMap) return;
            testMap.setView([16.0544, 108.2022], 13);
            updateStatus('ğŸ“ ÄÃ£ chuyá»ƒn Ä‘áº¿n ÄÃ  Náºµng');
        }
        
        function testRoute() {
            if (!testMap) return;
            
            const start = [10.8231, 106.6297]; // HCM
            const end = [10.7769, 106.6955];   // Landmark 81
            
            // Create a simple polyline route
            const route = L.polyline([start, end], {
                color: 'red',
                weight: 3,
                opacity: 0.7
            }).addTo(testMap);
            
            // Add markers for start and end
            L.marker(start).addTo(testMap).bindPopup('ğŸš Äiá»ƒm xuáº¥t phÃ¡t');
            L.marker(end).addTo(testMap).bindPopup('ğŸ“¦ Äiá»ƒm giao hÃ ng');
            
            // Fit map to show the route
            testMap.fitBounds(route.getBounds(), {padding: [20, 20]});
            
            updateStatus('âœ… ÄÃ£ táº¡o route test thÃ nh cÃ´ng');
        }
        
        // Initialize when page loads
        window.onload = function() {
            setTimeout(initMap, 500); // Small delay to ensure DOM is ready
        };
    </script>
</body>
</html>
